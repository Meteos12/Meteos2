<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>シール計算ツール</title>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  margin:0;
  padding:16px;
  background:#f5f5f5;
}
h2{margin:8px 0;}
input[type="number"]{
  width:100%;
  padding:10px;
  font-size:16px;
  margin:6px 0 12px 0;
  box-sizing:border-box;
}
.tabs{
  display:flex;
  margin-bottom:12px;
}
.tab{
  flex:1;
  text-align:center;
  padding:10px;
  background:#ddd;
  cursor:pointer;
  font-weight:bold;
}
.tab.active{
  background:#333;
  color:#fff;
}
.section{
  display:none;
  background:#fff;
  padding:12px;
  border-radius:6px;
}
.section.active{display:block;}
.result{
  margin-top:12px;
  font-size:16px;
  line-height:1.6;
  white-space:pre-line;
}
</style>
</head>
<body>

<h2>合計枚数</h2>
<input type="number" id="totalInput" min="0" placeholder="枚数を入力">

<div class="tabs">
  <div class="tab active" data-target="sizeSection">サイズシール</div>
  <div class="tab" data-target="sheetSection">44枚シート</div>
</div>

<!-- サイズ -->
<div id="sizeSection" class="section active">
  <label><input type="radio" name="sizeMode" value="normal" checked> 通常計算</label><br>
  <label><input type="radio" name="sizeMode" value="70"> 70枚セット</label><br>
  <label><input type="radio" name="sizeMode" value="80"> 80枚セット</label><br>
  <label>
    <input type="radio" name="sizeMode" value="custom">
    <input type="number" id="sizeCustom" min="1" style="width:80px;"> 枚セット
  </label>
  <div class="result" id="sizeResult"></div>
</div>

<!-- 44 -->
<div id="sheetSection" class="section">
  <label><input type="radio" name="sheetMode" value="normal" checked> 通常（44単位）</label><br>
  <label><input type="radio" name="sheetMode" value="70"> 70枚セット</label><br>
  <label><input type="radio" name="sheetMode" value="80"> 80枚セット</label><br>
  <label>
    <input type="radio" name="sheetMode" value="custom">
    <input type="number" id="sheetCustom" min="1" style="width:80px;"> 枚セット
  </label>
  <div class="result" id="sheetResult"></div>
</div>

<script>
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.target).classList.add("active");
  });
});

document.querySelectorAll("input").forEach(el=>{
  el.addEventListener("input",calculate);
  el.addEventListener("change",calculate);
});

function calculate(){
  const total = parseInt(document.getElementById("totalInput").value);
  if(!total || total<=0){
    sizeResult.textContent="";
    sheetResult.textContent="";
    return;
  }
  calculateSize(total);
  calculateSheet(total);
}

/* =========================
   サイズ計算
========================= */
function calculateSize(total){
  const mode=document.querySelector('input[name="sizeMode"]:checked').value;
  const result=document.getElementById("sizeResult");
  result.textContent="";

  if(mode==="normal"){
    let n=total;
    if(n%6===0){
      result.textContent=(n/6)+"列";
      return;
    }
    result.textContent=sizeDecomposeBlock(n,false);
  }
  else{
    let setSize=mode==="70"?70:mode==="80"?80:parseInt(sizeCustom.value);
    if(!setSize) return;

    let setCount=Math.floor(total/setSize);
    let rest=total%setSize;

    if(setCount>0){
      let line=sizeDecomposeInline(setSize,setSize);
      if(setCount>1) line+=" ×"+setCount;
      result.textContent=line;

      if(rest>0){
        result.textContent+="\n"+sizeDecomposeInline(rest,null);
      }
    }else{
      // ★ 修正ポイント：セット未満でも1行表示
      result.textContent=sizeDecomposeInline(total,null);
    }
  }
}

function sizeDecomposeBlock(n){
  let set42=Math.floor(n/42); n%=42;
  let dan=Math.floor(n/7); n%=7;
  let col=Math.floor(n/6); n%=6;

  let lines=[];
  if(set42) lines.push("42枚セット ×"+set42);
  if(dan) lines.push(dan+"段");
  if(col) lines.push(col+"列");
  if(n) lines.push("余り"+n+"枚");
  return lines.join("\n");
}

function sizeDecomposeInline(n,setLabel){
  let original=n;
  let set42=Math.floor(n/42); n%=42;
  let dan=Math.floor(n/7); n%=7;
  let col=Math.floor(n/6); n%=6;

  let parts=[];
  if(set42) parts.push("42枚セット ×"+set42);
  if(dan) parts.push(dan+"段("+dan*7+"枚)");
  if(col) parts.push(col+"列("+col*6+"枚)");
  if(n) parts.push("余り"+n+"枚");

  let line=parts.join(" + ");
  if(setLabel) line+="（"+setLabel+"枚セット）";
  return line;
}

/* =========================
   44枚シート計算
========================= */
function calculateSheet(total){
  const mode=document.querySelector('input[name="sheetMode"]:checked').value;
  const result=document.getElementById("sheetResult");
  result.textContent="";

  if(mode==="normal"){
    result.textContent=sheetDecomposeBlock(total);
  }
  else{
    let setSize=mode==="70"?70:mode==="80"?80:parseInt(sheetCustom.value);
    if(!setSize) return;

    let setCount=Math.floor(total/setSize);
    let rest=total%setSize;

    if(setCount>0){
      let line=sheetDecomposeInline(setSize,setSize);
      if(setCount>1) line+=" ×"+setCount;
      result.textContent=line;

      if(rest>0){
        result.textContent+="\n"+sheetDecomposeInline(rest,null);
      }
    }else{
      // ★ 修正ポイント：セット未満でも1行表示
      result.textContent=sheetDecomposeInline(total,null);
    }
  }
}

function sheetDecomposeBlock(n){
  let sheet=Math.floor(n/44); n%=44;
  let dan=Math.floor(n/4); n%=4;

  let lines=[];
  if(sheet) lines.push("44枚シート ×"+sheet);
  if(dan) lines.push(dan+"段("+dan*4+"枚)");
  if(n) lines.push("余り"+n+"枚");
  return lines.join("\n");
}

function sheetDecomposeInline(n,setLabel){
  let sheet=Math.floor(n/44); n%=44;
  let dan=Math.floor(n/4); n%=4;

  let parts=[];
  if(sheet) parts.push("44枚シート ×"+sheet);
  if(dan) parts.push(dan+"段("+dan*4+"枚)");
  if(n) parts.push("余り"+n+"枚");

  let line=parts.join(" + ");
  if(setLabel) line+="（"+setLabel+"枚セット）";
  return line;
}
</script>

</body>
</html>
